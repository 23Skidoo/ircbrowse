ircbrowsedir=$1
cd $ircbrowsedir

# Just bail out if anything fails.
set -e

logger -t ircbrowse "Clearing server logs ..."
rm -r log/*
rm cache/*

logger -t ircbrowse "Importing yesterday ..."
dist/build/ircbrowse/ircbrowse ircbrowse.conf import-yesterday

logger -t ircbrowse "Restarting server ..."
killall ircbrowse

logger -t ircbrowse "Regenerating Sphinx index ..."
/opt/sphinx/bin/indexer --all

logger -t ircbrowse "Import finished."
