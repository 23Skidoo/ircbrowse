ircbrowsedir=$1
cd $ircbrowsedir

# Just bail out if anything fails.
set -e

logger -t ircbrowse "Importing yesterday ..."
dist/build/ircbrowse/ircbrowse ircbrowse.conf import-yesterday >> /tmp/ircbrowse-cron.log

logger -t ircbrowse "Restarting server ..."
scripts/server-restart >> /tmp/ircbrowse-cron.log

logger -t ircbrowse "Regenerating Sphinx index ..."
/opt/sphinx/bin/indexer --all >> /tmp/ircbrowse-cron.log

logger -t ircbrowse "Import finished."
